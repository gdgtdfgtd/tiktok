<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>FireTok 2.0</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <style>
        :root {
            --primary: #ff3300; /* –Ø—Ä–∫–∏–π –æ–≥–æ–Ω—å */
            --primary-dark: #cc2900;
            --bg: #000000;
            --glass: rgba(30, 30, 30, 0.85);
            --text: #ffffff;
            --gray: #888888;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif; -webkit-tap-highlight-color: transparent; }
        
        body { background: var(--bg); color: var(--text); overflow: hidden; height: 100vh; width: 100vw; }
        
        button { border: none; outline: none; cursor: pointer; }
        input, textarea { outline: none; }

        /* --- AUTH SCREEN (REGISTRATION) --- */
        #auth-screen {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: black; z-index: 9999;
            display: flex; flex-direction: column; justify-content: center; align-items: center;
            padding: 30px;
        }
        .logo-text { font-size: 40px; font-weight: 900; color: var(--primary); margin-bottom: 10px; letter-spacing: -2px; }
        .auth-input {
            width: 100%; padding: 15px; margin: 10px 0;
            background: #222; border: 1px solid #333; border-radius: 12px;
            color: white; font-size: 16px;
        }
        .auth-btn {
            width: 100%; padding: 15px; margin-top: 20px;
            background: linear-gradient(45deg, var(--primary), #ff8800);
            color: white; font-weight: bold; font-size: 18px; border-radius: 12px;
        }

        /* --- FEED & VIDEO --- */
        .app-container { display: flex; height: 100%; width: 100%; flex-direction: column; }
        .feed {
            flex: 1; height: 100%; overflow-y: scroll; scroll-snap-type: y mandatory;
            position: relative; scrollbar-width: none;
        }
        .feed::-webkit-scrollbar { display: none; }

        .video-container {
            height: 100vh; width: 100%; scroll-snap-align: start; position: relative;
            background: #050505; border-bottom: 1px solid #111;
        }
        video { width: 100%; height: 100%; object-fit: cover; display: block; }

        /* --- UI ELEMENTS --- */
        .overlay {
            position: absolute; bottom: 0; left: 0; width: 100%; padding: 20px 20px 80px 20px;
            background: linear-gradient(to top, rgba(0,0,0,0.9), transparent); pointer-events: none;
        }
        .video-info { pointer-events: auto; max-width: 75%; }
        .username { font-weight: 700; font-size: 17px; margin-bottom: 5px; display: flex; align-items: center; gap: 5px; }
        .verified { color: #3897f0; font-size: 12px; }
        .description { font-size: 14px; line-height: 1.3; text-shadow: 1px 1px 2px rgba(0,0,0,0.5); }
        .hashtags { color: var(--primary); font-weight: bold; margin-top: 5px; display: block;}

        .sidebar {
            position: absolute; right: 10px; bottom: 100px;
            display: flex; flex-direction: column; gap: 25px; align-items: center; pointer-events: auto;
        }
        .sidebar-item { text-align: center; }
        .sidebar-icon {
            font-size: 28px; color: white; filter: drop-shadow(0 2px 5px rgba(0,0,0,0.5));
            transition: 0.2s;
        }
        .sidebar-count { font-size: 12px; font-weight: 600; margin-top: 4px; }
        .avatar-circle {
            width: 45px; height: 45px; border-radius: 50%; border: 2px solid white;
            background-size: cover; background-position: center; margin-bottom: 10px;
        }
        
        .liked { color: var(--primary); animation: pop 0.4s ease; }
        @keyframes pop { 50% { transform: scale(1.3); } }

        /* --- NAVBAR --- */
        .navbar {
            position: fixed; bottom: 0; width: 100%; height: 60px;
            background: black; border-top: 1px solid #222;
            display: flex; justify-content: space-between; align-items: center; padding: 0 20px;
            z-index: 1000;
        }
        .nav-btn { color: #666; font-size: 22px; padding: 10px; }
        .nav-btn.active { color: white; }
        .add-btn {
            width: 45px; height: 30px; background: white; border-radius: 8px;
            display: flex; justify-content: center; align-items: center; position: relative;
        }
        .add-btn::before, .add-btn::after {
            content: ''; position: absolute; width: 45px; height: 30px; border-radius: 8px; z-index: -1;
        }
        .add-btn::before { background: #00f2ea; left: -3px; }
        .add-btn::after { background: #ff0050; right: -3px; }
        .add-icon { color: black; font-size: 18px; }

        /* --- UPLOAD MODAL --- */
        #upload-modal {
            display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: #111; z-index: 2000; flex-direction: column;
        }
        .modal-header { padding: 15px; display: flex; justify-content: space-between; align-items: center; border-bottom: 1px solid #222; }
        .modal-body { padding: 20px; flex: 1; display: flex; flex-direction: column; gap: 15px; }
        .upload-preview { width: 100%; height: 200px; background: #222; border-radius: 10px; display: flex; align-items: center; justify-content: center; overflow: hidden; }
        #video-preview-el { height: 100%; width: auto; }
        .publish-btn { background: var(--primary); color: white; padding: 10px 20px; border-radius: 5px; font-weight: bold; }

        /* --- PROFILE --- */
        #profile-screen, #search-screen {
            display: none; position: fixed; top: 0; left: 0; width: 100%; height: calc(100% - 60px);
            background: var(--bg); z-index: 500; overflow-y: auto;
        }
        .profile-header { text-align: center; padding: 30px 20px; border-bottom: 1px solid #222; }
        .p-avatar { width: 90px; height: 90px; border-radius: 50%; background: #333; margin: 0 auto 15px; background-size: cover; }
        .p-name { font-size: 20px; font-weight: bold; }
        .p-user { color: var(--gray); font-size: 14px; margin-bottom: 15px; }
        .p-stats { display: flex; justify-content: center; gap: 25px; }
        .p-stat-val { font-weight: bold; font-size: 18px; }
        .p-stat-lbl { color: var(--gray); font-size: 12px; }
        
        /* --- SEARCH --- */
        .search-bar-container { padding: 15px; border-bottom: 1px solid #222; }
        .search-input { width: 100%; background: #222; padding: 10px 15px; border-radius: 8px; border: none; color: white; }
        .search-results { padding: 10px; }
        .search-item { display: flex; gap: 10px; margin-bottom: 15px; border-bottom: 1px solid #222; padding-bottom: 10px; }
        .s-thumb { width: 80px; height: 100px; background: #333; border-radius: 5px; object-fit: cover; }
        .s-info h4 { font-size: 14px; margin-bottom: 5px; }
        .s-info p { color: var(--gray); font-size: 12px; }

    </style>
</head>
<body>

    <!-- 1. AUTH SCREEN -->
    <div id="auth-screen">
        <div class="logo-text">FireTok üî•</div>
        <p style="color:gray; margin-bottom:30px">–°–≤–æ–±–æ–¥–∞ –∫–æ–Ω—Ç–µ–Ω—Ç–∞. –ë–µ–∑ –ø—Ä–∞–≤–∏–ª.</p>
        
        <input type="text" id="reg-name" class="auth-input" placeholder="–¢–≤–æ–µ –∏–º—è">
        <input type="text" id="reg-user" class="auth-input" placeholder="–ü—Ä–∏–¥—É–º–∞–π @username">
        <button class="auth-btn" onclick="registerUser()">–°–æ–∑–¥–∞—Ç—å –∞–∫–∫–∞—É–Ω—Ç</button>
    </div>

    <!-- 2. MAIN FEED -->
    <div class="app-container" id="main-app" style="display:none">
        <div class="feed" id="feed">
            <!-- Videos injected here -->
        </div>
    </div>

    <!-- 3. SEARCH SCREEN -->
    <div id="search-screen">
        <div class="search-bar-container">
            <input type="text" class="search-input" id="searchInput" placeholder="–ü–æ–∏—Å–∫ –ø–æ —Ö–µ—à—Ç–µ–≥–∞–º –∏ –Ω–∞–∑–≤–∞–Ω–∏—è–º..." onkeyup="doSearch()">
        </div>
        <div class="search-results" id="searchResults">
            <div style="text-align:center; color:#444; margin-top:50px">–í–≤–µ–¥–∏—Ç–µ –∑–∞–ø—Ä–æ—Å...</div>
        </div>
    </div>

    <!-- 4. PROFILE SCREEN -->
    <div id="profile-screen">
        <div class="profile-header">
            <div class="p-avatar" id="my-avatar" style="background-image: url('https://cdn-icons-png.flaticon.com/512/847/847969.png')"></div>
            <div class="p-name" id="my-name">User</div>
            <div class="p-user" id="my-handle">@user</div>
            <div class="p-stats">
                <div><div class="p-stat-val" id="count-subs">0</div><div class="p-stat-lbl">–ü–æ–¥–ø–∏—Å—á–∏–∫–∏</div></div>
                <div><div class="p-stat-val" id="count-likes">0</div><div class="p-stat-lbl">–õ–∞–π–∫–∏</div></div>
                <div><div class="p-stat-val">0</div><div class="p-stat-lbl">–í–∏–¥–µ–æ</div></div>
            </div>
            <button style="margin-top:20px; background:#222; border:1px solid #444; color:white; padding:8px 24px; border-radius:4px">–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å</button>
        </div>
        <div style="padding:20px; text-align:center; color:gray">
            <i class="fas fa-lock"></i> <br> –í–∞—à–∏ –≤–∏–¥–µ–æ –ø–æ—è–≤—è—Ç—Å—è –∑–¥–µ—Å—å
        </div>
    </div>

    <!-- 5. UPLOAD MODAL -->
    <div id="upload-modal">
        <div class="modal-header">
            <span onclick="closeUpload()">–û—Ç–º–µ–Ω–∞</span>
            <span style="font-weight:bold">–ü—É–±–ª–∏–∫–∞—Ü–∏—è</span>
            <button class="publish-btn" onclick="publishVideo()">–û–ø—É–±–ª–∏–∫–æ–≤–∞—Ç—å</button>
        </div>
        <div class="modal-body">
            <div class="upload-preview">
                <video id="video-preview-el" loop muted playsinline></video>
            </div>
            <textarea id="upload-desc" class="auth-input" rows="3" placeholder="–û–ø–∏—Å–∞–Ω–∏–µ –≤–∞—à–µ–≥–æ –≤–∏–¥–µ–æ..."></textarea>
            <input id="upload-tags" type="text" class="auth-input" placeholder="#—Ö–µ—à—Ç–µ–≥–∏ #—Ç—Ä–µ–Ω–¥—ã #–æ–≥–æ–Ω—å">
            <p style="color:gray; font-size:12px">–í–∏–¥–µ–æ –±—É–¥–µ—Ç –¥–æ—Å—Ç—É–ø–Ω–æ –≤ –ø–æ–∏—Å–∫–µ —Å—Ä–∞–∑—É –ø–æ—Å–ª–µ –ø—É–±–ª–∏–∫–∞—Ü–∏–∏.</p>
        </div>
    </div>

    <!-- HIDDEN INPUT FOR FILE -->
    <input type="file" id="file-input" accept="video/*" style="display:none" onchange="fileSelected(this)">

    <!-- NAVBAR -->
    <div class="navbar" id="navbar">
        <div class="nav-btn active" onclick="nav('home')"><i class="fas fa-home"></i></div>
        <div class="nav-btn" onclick="nav('search')"><i class="fas fa-search"></i></div>
        
        <div class="add-btn" onclick="document.getElementById('file-input').click()">
            <i class="fas fa-plus add-icon"></i>
        </div>
        
        <div class="nav-btn" onclick="alert('–£–≤–µ–¥–æ–º–ª–µ–Ω–∏–π –ø–æ–∫–∞ –Ω–µ—Ç')"><i class="far fa-comment-dots"></i></div>
        <div class="nav-btn" onclick="nav('profile')"><i class="far fa-user"></i></div>
    </div>

    <script>
        // --- GLOBAL STATE ---
        let currentUser = JSON.parse(localStorage.getItem('firetok_user')) || null;
        
        // Default Videos (—á—Ç–æ–±—ã –ª–µ–Ω—Ç–∞ –Ω–µ –±—ã–ª–∞ –ø—É—Å—Ç–æ–π)
        const defaultVideos = [
            {
                id: 1,
                url: "https://assets.mixkit.co/videos/preview/mixkit-fireworks-illuminating-the-beach-sky-4161-large.mp4",
                user: "FireTok_Official",
                avatar: "https://cdn-icons-png.flaticon.com/512/785/785116.png",
                desc: "–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ FireTok! –¢—É—Ç –Ω–µ—Ç –ø—Ä–∞–≤–∏–ª. üî•",
                tags: "#welcome #start",
                likes: 5400,
                comments: 120
            },
            {
                id: 2,
                url: "https://assets.mixkit.co/videos/preview/mixkit-girl-in-neon-sign-1232-large.mp4",
                user: "NeonQueen",
                avatar: "https://cdn-icons-png.flaticon.com/512/924/924915.png",
                desc: "–ù–æ—á–Ω–æ–π –≥–æ—Ä–æ–¥ –ø—Ä–µ–∫—Ä–∞—Å–µ–Ω üåÉ",
                tags: "#neon #city #vibe",
                likes: 2300,
                comments: 45
            }
        ];

        // Combine default videos with uploaded ones
        let uploadedVideos = JSON.parse(localStorage.getItem('firetok_videos')) || [];
        let allVideos = [...uploadedVideos.reverse(), ...defaultVideos];

        let tempVideoFile = null; // Storing file during upload

        // --- INIT ---
        window.onload = () => {
            if (currentUser) {
                document.getElementById('auth-screen').style.display = 'none';
                document.getElementById('main-app').style.display = 'flex';
                document.getElementById('navbar').style.display = 'flex';
                loadProfile();
                renderFeed();
            } else {
                document.getElementById('auth-screen').style.display = 'flex';
                document.getElementById('navbar').style.display = 'none';
            }
        }

        // --- REGISTRATION ---
        function registerUser() {
            const name = document.getElementById('reg-name').value;
            let handle = document.getElementById('reg-user').value;

            if(!name || !handle) return alert("–ó–∞–ø–æ–ª–Ω–∏ –≤—Å–µ –ø–æ–ª—è!");
            if(!handle.startsWith('@')) handle = '@' + handle;

            currentUser = {
                name: name,
                handle: handle,
                subs: 0,
                likes: 0
            };

            localStorage.setItem('firetok_user', JSON.stringify(currentUser));
            location.reload(); // Reload to start app
        }

        function loadProfile() {
            document.getElementById('my-name').innerText = currentUser.name;
            document.getElementById('my-handle').innerText = currentUser.handle;
            document.getElementById('count-subs').innerText = currentUser.subs;
            document.getElementById('count-likes').innerText = currentUser.likes;
        }

        // --- FEED LOGIC ---
        function renderFeed() {
            const feed = document.getElementById('feed');
            feed.innerHTML = "";
            
            allVideos.forEach((vid) => {
                const div = document.createElement('div');
                div.className = 'video-container';
                div.innerHTML = `
                    <video src="${vid.url}" loop onclick="togglePlay(this)"></video>
                    
                    <div class="sidebar">
                        <div class="sidebar-item">
                            <div class="avatar-circle" style="background-image: url('${vid.avatar}')"></div>
                        </div>
                        <div class="sidebar-item" onclick="toggleLike(this)">
                            <i class="fas fa-heart sidebar-icon"></i>
                            <div class="sidebar-count">${formatNum(vid.likes)}</div>
                        </div>
                        <div class="sidebar-item">
                            <i class="fas fa-comment-dots sidebar-icon"></i>
                            <div class="sidebar-count">${formatNum(vid.comments)}</div>
                        </div>
                        <div class="sidebar-item">
                            <i class="fas fa-share sidebar-icon"></i>
                            <div class="sidebar-count">Share</div>
                        </div>
                    </div>

                    <div class="overlay">
                        <div class="video-info">
                            <div class="username">${vid.user}</div>
                            <div class="description">${vid.desc}</div>
                            <div class="hashtags">${vid.tags}</div>
                        </div>
                    </div>
                `;
                feed.appendChild(div);
            });

            // Intersection Observer for Autoplay
            const observer = new IntersectionObserver((entries) => {
                entries.forEach(entry => {
                    const v = entry.target.querySelector('video');
                    if (entry.isIntersecting) v.play().catch(e => {});
                    else {
                        v.pause();
                        v.currentTime = 0;
                    }
                });
            }, { threshold: 0.6 });

            document.querySelectorAll('.video-container').forEach(el => observer.observe(el));
        }

        function togglePlay(vid) {
            vid.paused ? vid.play() : vid.pause();
        }

        function toggleLike(btn) {
            const icon = btn.querySelector('i');
            const count = btn.querySelector('.sidebar-count');
            let val = parseInt(count.innerText);
            
            if (icon.classList.contains('liked')) {
                icon.classList.remove('liked');
                // count.innerText = val - 1; // Optional logic
            } else {
                icon.classList.add('liked');
                // count.innerText = val + 1;
            }
        }

        function formatNum(num) {
            if (num >= 1000) return (num / 1000).toFixed(1) + 'k';
            return num;
        }

        // --- UPLOAD FLOW ---
        function fileSelected(input) {
            const file = input.files[0];
            if (file) {
                tempVideoFile = file;
                const url = URL.createObjectURL(file);
                
                const preview = document.getElementById('video-preview-el');
                preview.src = url;
                preview.play();

                document.getElementById('upload-modal').style.display = 'flex';
            }
        }

        function closeUpload() {
            document.getElementById('upload-modal').style.display = 'none';
            document.getElementById('file-input').value = "";
            const v = document.getElementById('video-preview-el');
            v.pause();
            v.src = "";
        }

        function publishVideo() {
            const desc = document.getElementById('upload-desc').value;
            const tags = document.getElementById('upload-tags').value;
            
            if (!tempVideoFile) return;

            // Create new video object
            const newVideo = {
                id: Date.now(),
                url: document.getElementById('video-preview-el').src, // Blob URL
                user: currentUser.handle, // –ò—Å–ø–æ–ª—å–∑—É–µ–º —Ç–≤–æ–π –Ω–∏–∫
                avatar: "https://cdn-icons-png.flaticon.com/512/847/847969.png",
                desc: desc || "–ë–µ–∑ –æ–ø–∏—Å–∞–Ω–∏—è",
                tags: tags,
                likes: 0,
                comments: 0
            };

            // Save to local list
            uploadedVideos.push(newVideo);
            localStorage.setItem('firetok_videos', JSON.stringify(uploadedVideos));

            // Reload feed
            allVideos = [...uploadedVideos.reverse(), ...defaultVideos];
            renderFeed();

            closeUpload();
            nav('home');
            alert("–í–∏–¥–µ–æ –æ–ø—É–±–ª–∏–∫–æ–≤–∞–Ω–æ! üî•");
        }

        // --- NAVIGATION & SEARCH ---
        function nav(page) {
            document.getElementById('feed').parentElement.style.display = 'none';
            document.getElementById('search-screen').style.display = 'none';
            document.getElementById('profile-screen').style.display = 'none';
            
            document.querySelectorAll('.nav-btn').forEach(b => b.classList.remove('active'));

            if (page === 'home') {
                document.getElementById('feed').parentElement.style.display = 'flex';
                document.querySelector('.nav-btn:nth-child(1)').classList.add('active');
            } else if (page === 'search') {
                document.getElementById('search-screen').style.display = 'block';
                document.querySelector('.nav-btn:nth-child(2)').classList.add('active');
            } else if (page === 'profile') {
                document.getElementById('profile-screen').style.display = 'block';
                document.querySelector('.nav-btn:nth-child(5)').classList.add('active');
            }
        }

        function doSearch() {
            const query = document.getElementById('searchInput').value.toLowerCase();
            const results = document.getElementById('searchResults');
            results.innerHTML = "";

            if (query.length < 2) return;

            const found = allVideos.filter(v => 
                (v.desc && v.desc.toLowerCase().includes(query)) || 
                (v.tags && v.tags.toLowerCase().includes(query))
            );

            if (found.length === 0) {
                results.innerHTML = "<div style='color:#666;text-align:center'>–ù–∏—á–µ–≥–æ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ üòî</div>";
                return;
            }

            found.forEach(v => {
                results.innerHTML += `
                    <div class="search-item">
                        <video class="s-thumb" src="${v.url}"></video>
                        <div class="s-info">
                            <h4>${v.desc.substring(0, 30)}...</h4>
                            <p style="color:var(--primary)">${v.tags}</p>
                            <p>–ê–≤—Ç–æ—Ä: ${v.user} ‚Ä¢ ‚ù§Ô∏è ${v.likes}</p>
                        </div>
                    </div>
                `;
            });
        }

    </script>
</body>
</html>
