<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>FireTok Infinity üî•</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <style>
        :root { --fire: #ff4500; --gold: #ffcc00; --bg: #000; --panel: #1a1a1a; --text: #fff; }
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Segoe UI', sans-serif; -webkit-tap-highlight-color: transparent; }
        body { background: var(--bg); color: var(--text); overflow: hidden; height: 100vh; }

        /* --- –≠–ö–†–ê–ù –í–•–û–î–ê --- */
        .auth-screen { position: fixed; inset: 0; background: #000; z-index: 10000; display: flex; flex-direction: column; justify-content: center; padding: 40px; }
        .auth-screen.hidden { display: none; }
        .logo { font-size: 50px; font-weight: 900; color: var(--fire); text-align: center; margin-bottom: 10px; text-shadow: 0 0 20px rgba(255,69,0,0.5); }
        input { width: 100%; padding: 16px; margin: 8px 0; background: #222; border: 1px solid #333; color: #fff; border-radius: 12px; font-size: 16px; outline: none; }
        .main-btn { width: 100%; padding: 16px; background: linear-gradient(45deg, var(--fire), var(--gold)); border: none; border-radius: 12px; color: #000; font-weight: bold; font-size: 18px; cursor: pointer; margin-top: 10px; }

        /* --- –ì–õ–ê–í–ù–ê–Ø –õ–ï–ù–¢–ê --- */
        .app { height: 100vh; display: flex; flex-direction: column; }
        .feed { flex: 1; overflow-y: scroll; scroll-snap-type: y mandatory; scrollbar-width: none; }
        .feed::-webkit-scrollbar { display: none; }
        .v-card { height: 100vh; width: 100%; scroll-snap-align: start; position: relative; background: #050505; }
        video { width: 100%; height: 100%; object-fit: cover; }

        /* –ò–ù–¢–ï–†–§–ï–ô–° –ü–û–í–ï–†–• –í–ò–î–ï–û */
        .ui { position: absolute; inset: 0; pointer-events: none; display: flex; flex-direction: column; justify-content: flex-end; padding: 20px; background: linear-gradient(0deg, rgba(0,0,0,0.7) 0%, transparent 40%); }
        .ui > * { pointer-events: auto; }
        
        .side-bar { position: absolute; right: 10px; bottom: 100px; display: flex; flex-direction: column; gap: 20px; align-items: center; }
        .side-item { text-align: center; color: #fff; }
        .side-item i { font-size: 32px; filter: drop-shadow(0 0 5px #000); }
        .side-item span { display: block; font-size: 12px; font-weight: bold; margin-top: 5px; }
        .btn-like.active { color: var(--fire); animation: heartBeat 0.4s; }
        @keyframes heartBeat { 50% { transform: scale(1.4); } }

        .v-info { max-width: 80%; margin-bottom: 50px; }
        .v-info h3 { font-size: 18px; display: flex; align-items: center; gap: 5px; }
        .v-info .verify { color: #3897f0; font-size: 14px; }
        .v-info p { font-size: 14px; margin-top: 5px; line-height: 1.4; }

        /* --- –ö–û–ú–ú–ï–ù–¢–ê–†–ò–ò (–ì–û–õ–û–°–û–í–´–ï, –§–û–¢–û, –°–¢–ò–ö–ï–†–´) --- */
        .comm-panel { position: fixed; bottom: -100%; left: 0; width: 100%; height: 75%; background: #1a1a1a; z-index: 5000; border-radius: 20px 20px 0 0; transition: 0.4s cubic-bezier(0.18, 0.89, 0.32, 1.28); display: flex; flex-direction: column; }
        .comm-panel.open { bottom: 0; }
        .comm-header { padding: 15px; text-align: center; border-bottom: 1px solid #333; font-weight: bold; }
        .comm-list { flex: 1; overflow-y: auto; padding: 15px; }
        .comm-input-box { padding: 15px; background: #222; display: flex; align-items: center; gap: 10px; border-top: 1px solid #333; }
        .voice-btn { color: var(--fire); font-size: 20px; }
        .sticker-btn { color: var(--gold); font-size: 20px; }
        
        .bubble { background: #333; padding: 10px; border-radius: 15px; margin-bottom: 10px; max-width: 90%; }
        .bubble b { font-size: 12px; color: var(--fire); display: block; margin-bottom: 3px; }
        .voice-msg { display: flex; align-items: center; gap: 10px; color: #0f0; }

        /* --- –ü–†–û–§–ò–õ–¨ --- */
        .page { position: fixed; inset: 0; background: #000; z-index: 4000; display: none; padding: 20px; overflow-y: auto; }
        .p-header { text-align: center; margin-top: 40px; }
        .p-avatar { width: 100px; height: 100px; border-radius: 50%; border: 3px solid var(--fire); margin: 0 auto; background: #333; overflow: hidden; }
        .p-stats { display: flex; justify-content: center; gap: 30px; margin: 20px 0; }
        .stat-n { font-size: 18px; font-weight: bold; }
        .stat-l { font-size: 12px; color: gray; }

        /* --- –ù–ê–í–ò–ì–ê–¶–ò–Ø --- */
        .nav { position: fixed; bottom: 0; width: 100%; height: 65px; background: #000; border-top: 1px solid #222; display: flex; justify-content: space-around; align-items: center; z-index: 4500; }
        .nav i { font-size: 24px; color: #555; transition: 0.3s; }
        .nav i.active { color: #fff; }
        .nav .add-fire { color: var(--fire) !important; font-size: 35px; }

        /* --- –°–¢–ò–ö–ï–†–´ –ò –§–û–¢–û --- */
        .media-preview { display: none; padding: 10px; background: #333; border-radius: 10px; margin-bottom: 5px; }
    </style>
</head>
<body>

    <!-- –≠–ö–†–ê–ù –í–•–û–î–ê -->
    <div class="auth-screen" id="auth-screen">
        <div class="logo">FireTok üî•</div>
        <p style="text-align:center; color: gray; margin-bottom: 20px;">–í–≤–µ–¥–∏—Ç–µ –¥–∞–Ω–Ω—ã–µ –¥–ª—è –≤—Ö–æ–¥–∞ –Ω–∞ —Å–µ—Ä–≤–µ—Ä</p>
        <input type="text" id="auth-name" placeholder="–ò–º—è –ø—Ä–æ—Ñ–∏–ª—è">
        <input type="text" id="auth-user" placeholder="@username">
        <input type="password" id="auth-pass" placeholder="–ü–∞—Ä–æ–ª—å">
        <button class="main-btn" onclick="handleAuth()">–í–æ–π—Ç–∏ –≤ –û–≥–æ–Ω–µ–∫</button>
    </div>

    <!-- –û–°–ù–û–í–ù–û–ï –ü–†–ò–õ–û–ñ–ï–ù–ò–ï -->
    <div class="app">
        <!-- –õ–ï–ù–¢–ê -->
        <div class="feed" id="main-feed">
            <!-- –í–∏–¥–µ–æ –±—É–¥—É—Ç —Ç—É—Ç -->
        </div>

        <!-- –ö–û–ú–ú–ï–ù–¢–ê–†–ò–ò -->
        <div class="comm-panel" id="comm-panel">
            <div class="comm-header">–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ <span style="float:right" onclick="toggleComm()">‚úï</span></div>
            <div class="comm-list" id="comm-list"></div>
            <div class="comm-input-box">
                <i class="fas fa-camera sticker-btn" onclick="addPhoto()"></i>
                <input type="text" id="comm-input" placeholder="–ù–∞–ø–∏—Å–∞—Ç—å..." style="margin:0">
                <i class="fas fa-grin-alt sticker-btn" onclick="addSticker()"></i>
                <i class="fas fa-microphone voice-btn" onclick="addVoice()"></i>
                <i class="fas fa-paper-plane" style="color:var(--fire)" onclick="sendComm()"></i>
            </div>
        </div>

        <!-- –ü–†–û–§–ò–õ–¨ -->
        <div class="page" id="profile-page">
            <div class="p-header">
                <div class="p-avatar"><img id="my-ava" src="https://api.dicebear.com/7.x/avataaars/svg?seed=fire" style="width:100%"></div>
                <h2 id="p-name">–ò–º—è</h2>
                <p id="p-user" style="color:gray">@username</p>
                <div class="p-stats">
                    <div class="stat-box"><div class="stat-n">1.5M</div><div class="stat-l">–ü–æ–¥–ø–∏—Å—á–∏–∫–∏</div></div>
                    <div class="stat-box"><div class="stat-n" id="my-total-likes">0</div><div class="stat-l">–õ–∞–π–∫–∏</div></div>
                    <div class="stat-box"><div class="stat-n">43</div><div class="stat-l">–î—Ä—É–∑—å—è</div></div>
                </div>
                <button class="main-btn" style="width:200px; padding:10px" onclick="location.reload()">–í—ã–π—Ç–∏</button>
            </div>
            <h3 style="margin-top:30px">–ú–æ–∏ –≤–∏–¥–µ–æ:</h3>
            <div id="my-vids-grid" style="display:grid; grid-template-columns: 1fr 1fr 1fr; gap:5px; margin-top:10px"></div>
        </div>

        <!-- –ü–û–ò–°–ö -->
        <div class="page" id="search-page">
            <input type="text" id="search-input" placeholder="–ü–æ–∏—Å–∫ –≤–∏–¥–µ–æ –∏–ª–∏ —Ö–µ—à—Ç–µ–≥–æ–≤..." oninput="doSearch()">
            <div id="search-results" style="margin-top:20px"></div>
        </div>

        <!-- –ó–ê–ì–†–£–ó–ö–ê -->
        <input type="file" id="upload-file" accept="video/*" style="display:none" onchange="handleUpload(this)">

        <!-- –ù–ò–ñ–ù–Ø–Ø –ü–ê–ù–ï–õ–¨ -->
        <div class="nav">
            <i class="fas fa-home active" onclick="showPage('feed')"></i>
            <i class="fas fa-search" onclick="showPage('search')"></i>
            <i class="fas fa-plus-circle add-fire" onclick="document.getElementById('upload-file').click()"></i>
            <i class="fas fa-users" onclick="alert('–î—Ä—É–∑—å—è –æ–Ω–ª–∞–π–Ω: 12')"></i>
            <i class="fas fa-user" onclick="showPage('profile')"></i>
        </div>
    </div>

    <script>
        // --- –ë–ê–ó–ê –î–ê–ù–ù–´–• (LOCALSTORAGE) ---
        let db = {
            user: JSON.parse(localStorage.getItem('ft_user')) || null,
            videos: JSON.parse(localStorage.getItem('ft_videos')) || [],
            likes: JSON.parse(localStorage.getItem('ft_likes')) || {}
        };

        // –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ –≤–∏–¥–µ–æ (—á—Ç–æ–±—ã –Ω–µ –±—ã–ª–æ –ø—É—Å—Ç–æ)
        const cloudVideos = [
            { id: 'v1', url: 'https://assets.mixkit.co/videos/preview/mixkit-fireworks-illuminating-the-beach-sky-4161-large.mp4', user: '@ogonek', desc: '–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ FireTok! –¢—É—Ç –Ω–µ—Ç –ø—Ä–∞–≤–∏–ª. üî• #—Å–≤–æ–±–æ–¥–∞', likes: 5402 },
            { id: 'v2', url: 'https://assets.mixkit.co/videos/preview/mixkit-waves-coming-to-the-beach-5016-large.mp4', user: '@ocean_vibes', desc: '–†–µ–ª–∞–∫—Å –±–µ–∑ —Ü–µ–Ω–∑—É—Ä—ã... üåä #vibe #water', likes: 1205 }
        ];

        // --- –í–•–û–î ---
        if(db.user) {
            document.getElementById('auth-screen').classList.add('hidden');
            loadApp();
        }

        function handleAuth() {
            const name = document.getElementById('auth-name').value;
            const user = document.getElementById('auth-user').value;
            if(!name || !user) return alert("–ó–∞–ø–æ–ª–Ω–∏ –≤—Å–µ!");
            
            db.user = { name, handle: user.startsWith('@') ? user : '@'+user };
            localStorage.setItem('ft_user', JSON.stringify(db.user));
            location.reload();
        }

        function loadApp() {
            document.getElementById('p-name').innerText = db.user.name;
            document.getElementById('p-user').innerText = db.user.handle;
            renderFeed();
        }

        // --- –õ–ï–ù–¢–ê ---
        function renderFeed() {
            const container = document.getElementById('main-feed');
            container.innerHTML = "";
            const allVids = [...db.videos.slice().reverse(), ...cloudVideos];

            allVids.forEach(v => {
                const isLiked = db.likes[v.id];
                const card = document.createElement('div');
                card.className = 'v-card';
                card.innerHTML = `
                    <video src="${v.url}" loop onclick="this.paused ? this.play() : this.pause()"></video>
                    <div class="side-bar">
                        <div class="side-item"><div style="width:45px;height:45px;background:#333;border-radius:50%;border:2px solid var(--fire)"></div></div>
                        <div class="side-item btn-like ${isLiked?'active':''}" onclick="toggleLike('${v.id}', this)">
                            <i class="fas fa-heart"></i>
                            <span>${v.likes + (isLiked?1:0)}</span>
                        </div>
                        <div class="side-item" onclick="toggleComm('${v.id}')">
                            <i class="fas fa-comment-dots"></i>
                            <span>${(v.comments || []).length}</span>
                        </div>
                        <div class="side-item" onclick="alert('–°—Å—ã–ª–∫–∞ —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∞!')">
                            <i class="fas fa-share"></i>
                            <span>–†–µ–ø–æ—Å—Ç</span>
                        </div>
                    </div>
                    <div class="ui">
                        <div class="v-info">
                            <h3>${v.user} <i class="fas fa-check-circle verify"></i></h3>
                            <p>${v.desc}</p>
                        </div>
                    </div>
                `;
                container.appendChild(card);
            });

            // –ê–≤—Ç–æ–ø–ª–µ–π
            const obs = new IntersectionObserver(e => {
                e.forEach(entry => {
                    const v = entry.target.querySelector('video');
                    if(entry.isIntersecting) v.play(); else v.pause();
                });
            }, {threshold: 0.7});
            document.querySelectorAll('.v-card').forEach(c => obs.observe(c));
        }

        // --- –õ–ê–ô–ö–ò ---
        function toggleLike(id, btn) {
            if(db.likes[id]) delete db.likes[id];
            else db.likes[id] = true;
            btn.classList.toggle('active');
            localStorage.setItem('ft_likes', JSON.stringify(db.likes));
            updateProfileStats();
        }

        // --- –ö–û–ú–ú–ï–ù–¢–ê–†–ò–ò (–§–£–ù–ö–¶–ò–ò 43+) ---
        let currentVidId = null;
        function toggleComm(id) {
            currentVidId = id;
            const p = document.getElementById('comm-panel');
            p.classList.toggle('open');
            if(p.classList.contains('open')) renderComments();
        }

        function renderComments() {
            const list = document.getElementById('comm-list');
            list.innerHTML = "";
            const v = [...db.videos, ...cloudVideos].find(vid => vid.id === currentVidId);
            if(v && v.comments) {
                v.comments.forEach(c => {
                    list.innerHTML += `<div class="bubble"><b>${c.user}</b>${c.text}</div>`;
                });
            }
        }

        function sendComm() {
            const input = document.getElementById('comm-input');
            if(!input.value) return;
            addCommentToDb({ user: db.user.handle, text: input.value });
            input.value = "";
        }

        function addVoice() {
            addCommentToDb({ user: db.user.handle, text: '<div class="voice-msg"><i class="fas fa-play"></i> üé§ –ì–æ–ª–æ—Å–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ (0:05)</div>' });
        }

        function addSticker() {
            addCommentToDb({ user: db.user.handle, text: '<img src="https://api.dicebear.com/7.x/icons/svg?seed=fire" style="width:50px">' });
        }

        function addPhoto() {
            addCommentToDb({ user: db.user.handle, text: '<div style="width:100px;height:100px;background:#444;border-radius:10px;display:flex;align-items:center;justify-content:center">üì∏ –§–æ—Ç–æ</div>' });
        }

        function addCommentToDb(comm) {
            let v = db.videos.find(vid => vid.id === currentVidId);
            if(!v) v = cloudVideos.find(vid => vid.id === currentVidId);
            if(!v.comments) v.comments = [];
            v.comments.push(comm);
            localStorage.setItem('ft_videos', JSON.stringify(db.videos));
            renderComments();
        }

        // --- –ó–ê–ì–†–£–ó–ö–ê –í–ò–î–ï–û ---
        function handleUpload(input) {
            const file = input.files[0];
            if(!file) return;
            const url = URL.createObjectURL(file);
            const desc = prompt("–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –∏ —Ö–µ—à—Ç–µ–≥–∏:");
            
            const newVid = {
                id: 'uv' + Date.now(),
                url: url,
                user: db.user.handle,
                desc: desc || "–ë–µ–∑ –æ–ø–∏—Å–∞–Ω–∏—è",
                likes: 0,
                comments: []
            };

            db.videos.push(newVid);
            localStorage.setItem('ft_videos', JSON.stringify(db.videos));
            alert("–í–∏–¥–µ–æ –æ–ø—É–±–ª–∏–∫–æ–≤–∞–Ω–æ!");
            location.reload();
        }

        // --- –ü–û–ò–°–ö ---
        function doSearch() {
            const q = document.getElementById('search-input').value.toLowerCase();
            const res = document.getElementById('search-results');
            res.innerHTML = "";
            const all = [...db.videos, ...cloudVideos];
            const filtered = all.filter(v => v.desc.toLowerCase().includes(q) || v.user.toLowerCase().includes(q));
            
            filtered.forEach(v => {
                res.innerHTML += `<div style="padding:15px; background:#111; margin-bottom:10px; border-radius:10px">
                    <b>${v.user}</b><br><small>${v.desc}</small>
                </div>`;
            });
        }

        // --- –ù–ê–í–ò–ì–ê–¶–ò–Ø –ú–ï–ñ–î–£ –°–¢–†–ê–ù–ò–¶–ê–ú–ò ---
        function showPage(page) {
            document.querySelectorAll('.page').forEach(p => p.style.display = 'none');
            document.querySelectorAll('.nav i').forEach(i => i.classList.remove('active'));
            
            if(page === 'feed') {
                document.querySelector('.fa-home').classList.add('active');
            } else if(page === 'search') {
                document.getElementById('search-page').style.display = 'block';
                document.querySelector('.fa-search').classList.add('active');
            } else if(page === 'profile') {
                document.getElementById('profile-page').style.display = 'block';
                document.querySelector('.fa-user').classList.add('active');
                updateProfileStats();
            }
        }

        function updateProfileStats() {
            const myVids = db.videos.filter(v => v.user === db.user.handle);
            let totalLikes = 0;
            myVids.forEach(v => { if(db.likes[v.id]) totalLikes++; });
            document.getElementById('my-total-likes').innerText = totalLikes + "K";
            
            const grid = document.getElementById('my-vids-grid');
            grid.innerHTML = "";
            myVids.forEach(v => {
                grid.innerHTML += `<div style="height:150px; background:#222; overflow:hidden"><video src="${v.url}" muted style="width:100%;height:100%;object-fit:cover"></video></div>`;
            });
        }

    </script>
</body>
</html>
