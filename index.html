<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>FireTok Ultra üî•</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <style>
        :root { --fire: #ff4500; --bg: #000; --text: #fff; --gray: #222; }
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: sans-serif; -webkit-tap-highlight-color: transparent; }
        body { background: var(--bg); color: var(--text); overflow: hidden; height: 100vh; }

        /* --- –≠–ö–†–ê–ù –í–•–û–î–ê --- */
        #auth-screen { position: fixed; inset: 0; background: #000; z-index: 10000; display: flex; flex-direction: column; justify-content: center; padding: 40px; }
        input { width: 100%; padding: 16px; margin: 8px 0; background: #111; border: 1px solid #333; color: #fff; border-radius: 12px; font-size: 16px; outline: none; }
        .btn-fire { width: 100%; padding: 16px; background: var(--fire); border: none; border-radius: 12px; color: #fff; font-weight: bold; font-size: 18px; cursor: pointer; }

        /* --- –õ–ï–ù–¢–ê --- */
        .feed { height: 100vh; overflow-y: scroll; scroll-snap-type: y mandatory; scrollbar-width: none; }
        .feed::-webkit-scrollbar { display: none; }
        .v-card { height: 100vh; width: 100%; scroll-snap-align: start; position: relative; background: #000; }
        
        /* –í–∏–¥–µ–æ —Ç–µ–ø–µ—Ä—å —Å muted, —á—Ç–æ–±—ã –Ω–µ –±—ã–ª–æ –æ—à–∏–±–∫–∏ NotAllowedError */
        video { width: 100%; height: 100%; object-fit: cover; background: #000; }

        /* –ò–ù–¢–ï–†–§–ï–ô–° */
        .sidebar { position: absolute; right: 10px; bottom: 120px; display: flex; flex-direction: column; gap: 20px; align-items: center; }
        .side-item { text-align: center; color: white; cursor: pointer; }
        .side-item i { font-size: 35px; text-shadow: 0 2px 10px rgba(0,0,0,0.5); }
        .side-item span { display: block; font-size: 12px; font-weight: bold; margin-top: 5px; }
        .liked { color: var(--fire) !important; }

        .info { position: absolute; bottom: 80px; left: 15px; max-width: 75%; text-shadow: 1px 1px 5px #000; pointer-events: none; }
        .info h3 { font-size: 18px; margin-bottom: 5px; pointer-events: auto; }
        .info p { font-size: 14px; pointer-events: auto; }

        /* –ü–ê–ù–ï–õ–¨ –ö–û–ú–ú–ï–ù–¢–û–í */
        #comm-panel { position: fixed; bottom: -100%; left: 0; width: 100%; height: 70%; background: #111; z-index: 5000; border-radius: 20px 20px 0 0; transition: 0.3s; display: flex; flex-direction: column; }
        #comm-panel.active { bottom: 0; }
        .c-list { flex: 1; overflow-y: auto; padding: 15px; }
        .c-msg { margin-bottom: 15px; }
        .c-msg b { color: var(--fire); font-size: 12px; display: block; }
        .c-input-area { padding: 15px; background: #1a1a1a; display: flex; align-items: center; gap: 10px; }
        .c-input-area input { margin: 0; flex: 1; }

        /* –ù–ê–í–ò–ì–ê–¶–ò–Ø */
        .nav { position: fixed; bottom: 0; width: 100%; height: 60px; background: #000; border-top: 1px solid #222; display: flex; justify-content: space-around; align-items: center; z-index: 4000; }
        .nav i { font-size: 24px; color: #555; cursor: pointer; }
        .nav i.active { color: #fff; }

        /* –°–¢–†–ê–ù–ò–¶–´ */
        .page { position: fixed; inset: 0; background: #000; z-index: 3000; display: none; padding: 20px; overflow-y: auto; }
        .p-stat { display: flex; justify-content: center; gap: 25px; margin: 20px 0; }
        .p-stat div { text-align: center; }
        .p-stat b { display: block; font-size: 20px; }
        
        .error-overlay { position: absolute; inset: 0; display: flex; flex-direction: column; justify-content: center; align-items: center; background: #111; color: gray; text-align: center; padding: 20px; }
    </style>
</head>
<body>

    <!-- 1. –ê–í–¢–û–†–ò–ó–ê–¶–ò–Ø -->
    <div id="auth-screen">
        <h1 style="color:var(--fire); text-align:center; font-size:40px; margin-bottom:20px">FireTok üî•</h1>
        <input type="text" id="reg-name" placeholder="–ò–º—è">
        <input type="text" id="reg-user" placeholder="@username">
        <input type="password" id="reg-pass" placeholder="–ü–∞—Ä–æ–ª—å">
        <button class="btn-fire" onclick="auth()">–í–æ–π—Ç–∏</button>
    </div>

    <!-- 2. –õ–ï–ù–¢–ê -->
    <div class="feed" id="feed"></div>

    <!-- 3. –ö–û–ú–ú–ï–ù–¢–ê–†–ò–ò -->
    <div id="comm-panel">
        <div style="padding:15px; text-align:center; border-bottom:1px solid #222">
            –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ <span style="float:right" onclick="toggleComm()">‚úï</span>
        </div>
        <div class="c-list" id="c-list"></div>
        <div class="c-input-area">
            <i class="fas fa-microphone" style="color:var(--fire)" onclick="sendMedia('voice')"></i>
            <i class="fas fa-camera" style="color:cyan" onclick="sendMedia('photo')"></i>
            <input type="text" id="c-input" placeholder="–ù–∞–ø–∏—à–∏...">
            <i class="fas fa-paper-plane" onclick="sendText()"></i>
        </div>
    </div>

    <!-- 4. –ü–†–û–§–ò–õ–¨ -->
    <div class="page" id="profile-page">
        <div style="text-align:center; margin-top:40px">
            <div style="width:100px; height:100px; border-radius:50%; background:var(--fire); margin:0 auto"></div>
            <h2 id="p-name">–ò–º—è</h2>
            <p id="p-user" style="color:gray">@user</p>
            <div class="p-stat">
                <div><b id="p-subs">1.2M</b>–ü–æ–¥–ø–∏—Å—á–∏–∫–∏</div>
                <div><b id="p-likes">0</b>–õ–∞–π–∫–∏</div>
                <div><b>43</b>–§—É–Ω–∫—Ü–∏–∏</div>
            </div>
            <button class="btn-fire" style="width:150px" onclick="location.reload()">–í—ã–π—Ç–∏</button>
        </div>
        <h3 style="margin-top:40px">–¢–≤–æ–∏ –≤–∏–¥–µ–æ:</h3>
        <div id="my-vids" style="display:grid; grid-template-columns:1fr 1fr 1fr; gap:5px; margin-top:10px"></div>
    </div>

    <!-- 5. –ü–û–ò–°–ö -->
    <div class="page" id="search-page">
        <input type="text" placeholder="–ü–æ–∏—Å–∫ –ø–æ —Ö–µ—à—Ç–µ–≥–∞–º..." style="background:#222">
        <div style="margin-top:20px; color:gray">–ù–∏—á–µ–≥–æ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ</div>
    </div>

    <!-- –ó–ê–ì–†–£–ó–ö–ê -->
    <input type="file" id="up-file" accept="video/*" style="display:none" onchange="upload(this)">

    <!-- –ù–ê–í–ò–ì–ê–¶–ò–Ø -->
    <div class="nav">
        <i class="fas fa-home active" onclick="nav('home')"></i>
        <i class="fas fa-search" onclick="nav('search')"></i>
        <i class="fas fa-plus-square" style="font-size:35px; color:var(--fire)" onclick="document.getElementById('up-file').click()"></i>
        <i class="fas fa-users" onclick="alert('–í—Å–µ –¥—Ä—É–∑—å—è –≤ —Å–µ—Ç–∏!')"></i>
        <i class="fas fa-user" onclick="nav('profile')"></i>
    </div>

    <script>
        // --- –î–ê–ù–ù–´–ï ---
        let user = JSON.parse(localStorage.getItem('user')) || null;
        let vids = JSON.parse(localStorage.getItem('vids')) || [
            {id: 1, url: 'https://assets.mixkit.co/videos/preview/mixkit-fireworks-illuminating-the-beach-sky-4161-large.mp4', user: '@ogonek', desc: '–ü–µ—Ä–≤–æ–µ –≤–∏–¥–µ–æ –±–µ–∑ –ø—Ä–∞–≤–∏–ª! üî• #free', likes: 120, comments: []}
        ];

        // --- –í–•–û–î ---
        if(user) {
            document.getElementById('auth-screen').style.display = 'none';
            init();
        }

        function auth() {
            const name = document.getElementById('reg-name').value;
            const handle = document.getElementById('reg-user').value;
            if(!name || !handle) return alert("–ó–∞–ø–æ–ª–Ω–∏ –¥–∞–Ω–Ω—ã–µ!");
            user = { name, handle: handle.startsWith('@')?handle:'@'+handle, likes: 0 };
            localStorage.setItem('user', JSON.stringify(user));
            location.reload();
        }

        function init() {
            document.getElementById('p-name').innerText = user.name;
            document.getElementById('p-user').innerText = user.handle;
            render();
        }

        // --- –õ–ï–ù–¢–ê ---
        function render() {
            const feed = document.getElementById('feed');
            feed.innerHTML = "";
            
            vids.slice().reverse().forEach((v, i) => {
                const card = document.createElement('div');
                card.className = 'v-card';
                // muted –ø–æ–º–æ–≥–∞–µ—Ç –æ–±–æ–π—Ç–∏ –æ—à–∏–±–∫—É NotAllowedError
                card.innerHTML = `
                    <video src="${v.url}" loop muted playsinline onclick="playVideo(this)" onerror="videoError(this)"></video>
                    <div class="sidebar">
                        <div class="side-item" onclick="like(${v.id}, this)">
                            <i class="fas fa-heart"></i>
                            <span>${v.likes}</span>
                        </div>
                        <div class="side-item" onclick="toggleComm(${v.id})">
                            <i class="fas fa-comment-dots"></i>
                            <span>${v.comments.length}</span>
                        </div>
                        <div class="side-item" onclick="alert('–†–µ–ø–æ—Å—Ç —Å–¥–µ–ª–∞–Ω!')">
                            <i class="fas fa-share"></i>
                            <span>–†–µ–ø–æ—Å—Ç</span>
                        </div>
                    </div>
                    <div class="info">
                        <h3>${v.user}</h3>
                        <p>${v.desc}</p>
                    </div>
                `;
                feed.appendChild(card);
            });

            // IntersectionObserver –¥–ª—è –∞–≤—Ç–æ–ø–ª–µ—è
            const obs = new IntersectionObserver(entries => {
                entries.forEach(entry => {
                    const vid = entry.target.querySelector('video');
                    if(entry.isIntersecting) {
                        vid.play().catch(() => {
                            // –ï—Å–ª–∏ –≤—Å—ë –µ—â–µ –æ—à–∏–±–∫–∞, –∂–¥–µ–º –∫–ª–∏–∫–∞
                            console.log("–ñ–¥–µ–º –∫–ª–∏–∫–∞ –¥–ª—è –∑–≤—É–∫–∞...");
                        });
                    } else {
                        vid.pause();
                    }
                });
            }, {threshold: 0.8});
            document.querySelectorAll('.v-card').forEach(c => obs.observe(c));
        }

        // –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –æ—à–∏–±–∫–∏ Blob –∏ –ø—Ä–∞–≤ –¥–æ—Å—Ç—É–ø–∞
        function playVideo(vid) {
            if(vid.paused) {
                vid.muted = false; // –í–∫–ª—é—á–∞–µ–º –∑–≤—É–∫ –ø—Ä–∏ –∫–ª–∏–∫–µ
                vid.play();
            } else {
                vid.pause();
            }
        }

        function videoError(vid) {
            vid.parentElement.innerHTML = `
                <div class="error-overlay">
                    <i class="fas fa-exclamation-triangle" style="font-size:40px; margin-bottom:10px"></i>
                    <p>–í–∏–¥–µ–æ —É–¥–∞–ª–µ–Ω–æ –∏–∑ –ø–∞–º—è—Ç–∏ –±—Ä–∞—É–∑–µ—Ä–∞.<br>–ó–∞–≥—Ä—É–∑–∏—Ç–µ –µ–≥–æ —Å–Ω–æ–≤–∞ –∏–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ URL —Å—Å—ã–ª–∫—É.</p>
                </div>`;
        }

        // --- –î–ï–ô–°–¢–í–ò–Ø ---
        let currentVid = null;
        function toggleComm(id) {
            currentVid = id;
            document.getElementById('comm-panel').classList.toggle('active');
            renderComm();
        }

        function renderComm() {
            const list = document.getElementById('c-list');
            list.innerHTML = "";
            const v = vids.find(x => x.id == currentVid);
            v.comments.forEach(c => {
                list.innerHTML += `<div class="c-msg"><b>${c.u}</b>${c.t}</div>`;
            });
        }

        function sendText() {
            const input = document.getElementById('c-input');
            if(!input.value) return;
            const v = vids.find(x => x.id == currentVid);
            v.comments.push({u: user.handle, t: input.value});
            input.value = "";
            save(); renderComm();
        }

        function sendMedia(type) {
            const v = vids.find(x => x.id == currentVid);
            const content = type === 'voice' ? 'üé§ [–ì–æ–ª–æ—Å–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ]' : 'üì∏ [–§–æ—Ç–æ]';
            v.comments.push({u: user.handle, t: `<span style="color:gray">${content}</span>`});
            save(); renderComm();
        }

        function like(id, btn) {
            const v = vids.find(x => x.id == id);
            v.likes++;
            btn.querySelector('i').classList.add('liked');
            btn.querySelector('span').innerText = v.likes;
            save();
        }

        // --- –ó–ê–ì–†–£–ó–ö–ê ---
        function upload(input) {
            const file = input.files[0];
            if(!file) return;
            const url = URL.createObjectURL(file);
            const desc = prompt("–ù–∞–∑–≤–∞–Ω–∏–µ –≤–∏–¥–µ–æ –∏ —Ö–µ—à—Ç–µ–≥–∏:");
            
            const newVid = {
                id: Date.now(),
                url: url,
                user: user.handle,
                desc: desc || "",
                likes: 0,
                comments: []
            };
            vids.push(newVid);
            save();
            location.reload();
        }

        // --- –°–ï–†–í–ò–° ---
        function save() {
            localStorage.setItem('vids', JSON.stringify(vids));
        }

        function nav(page) {
            document.querySelectorAll('.page').forEach(p => p.style.display = 'none');
            document.querySelectorAll('.nav i').forEach(i => i.classList.remove('active'));
            if(page === 'home') {
                document.querySelector('.fa-home').classList.add('active');
            } else if(page === 'profile') {
                document.getElementById('profile-page').style.display = 'block';
                document.querySelector('.fa-user').classList.add('active');
                renderMyVids();
            } else if(page === 'search') {
                document.getElementById('search-page').style.display = 'block';
                document.querySelector('.fa-search').classList.add('active');
            }
        }

        function renderMyVids() {
            const container = document.getElementById('my-vids');
            container.innerHTML = "";
            vids.filter(x => x.user === user.handle).forEach(v => {
                container.innerHTML += `<div style="height:150px; background:#111"><video src="${v.url}" style="width:100%;height:100%;object-fit:cover"></video></div>`;
            });
        }
    </script>
</body>
</html>
